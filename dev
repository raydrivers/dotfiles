#!/bin/bash
set -e
cd "$(dirname "$0")"

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${GREEN}Pulling with rebase...${NC}"
if ! git pull --rebase; then
    echo -e "${RED}Rebase conflicts detected. Resolve them and run again.${NC}"
    exit 1
fi

echo -e "\n${GREEN}Running setup...${NC}"
./setup.sh

echo -e "\n${GREEN}Running cleanup...${NC}"
./cleanup.sh

echo -e "\n${GREEN}Committing...${NC}"
git add -A
if git diff --cached --quiet; then
    echo -e "${YELLOW}Nothing to commit${NC}"
else
    git commit
fi

echo -e "\n${GREEN}Pushing...${NC}"
git push
